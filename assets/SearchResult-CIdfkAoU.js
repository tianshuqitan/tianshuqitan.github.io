import{f as N,u as X,g as T,h as Z,y as ee,t as se,i as ae,j as V,k as L,l as a,m as le,n as te,s as re,R as A,p as ue,q as ie,v as ne,x as oe,z as ce,A as D,B as P,P as ve,C as me,D as he,E as ye,F as de,G as pe,H as ge,I as ke,J as $,K as fe,L as C}from"./app-DDF7JlyL.js";const Be=["/","/Unity/","/Bookmarks/AI/","/Bookmarks/Language/BookMarks_CSharp.html","/Bookmarks/Language/BookMarks_Go.html","/Bookmarks/Language/BookMarks_Lua.html","/Bookmarks/Language/BookMarks_Rust.html","/Bookmarks/Unity/","/Bookmarks/Unreal/","/Language/Csharp/","/Language/Go/","/Unity/Books/%E4%B8%BB%E7%A8%8B%E6%89%8B%E8%AE%B0.html","/Unity/Interview/","/Vue/Vuepress/","/Vue/Vuepress/VuePress_Config.html","/Vue/Vuepress/VuePress_Deployment.html","/Vue/Vuepress/VuePress_Install.html","/Vue/Vuepress/VuePress_ThemeHope.html","/Bookmarks/Unity/Plugins/BookMarks_Unity_Odin.html","/Language/Csharp/SourceCode/","/Language/Csharp/SourceCode/SourceCode_List.html","/404.html","/Bookmarks/","/Bookmarks/Language/","/Language/","/Unity/Books/","/Vue/","/Bookmarks/Unity/Plugins/","/category/","/tag/","/tag/vuepress/","/article/","/star/","/timeline/"],He="SLIMSEARCH_QUERY_HISTORY",p=$(He,[]),Le=()=>{const{queryHistoryCount:t}=C;return{enabled:t>0,queryHistories:p,addQueryHistory:i=>{p.value=Array.from(new Set([i,...p.value.slice(0,t-1)]))},removeQueryHistory:i=>{p.value=[...p.value.slice(0,i),...p.value.slice(i+1)]}}},_=t=>Be[t.id]+("anchor"in t?`#${t.anchor}`:""),Ce="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:M}=C,g=$(Ce,[]),Re=()=>({enabled:M>0,resultHistories:g,addResultHistory:u=>{{const i={link:_(u),display:u.display};"header"in u&&(i.header=u.header),g.value=[i,...g.value.slice(0,M-1)]}},removeResultHistory:u=>{g.value=[...g.value.slice(0,u),...g.value.slice(u+1)]}}),Se=t=>{const u=ve(),i=T(),R=me(),n=V(0),k=L(()=>n.value>0),v=he([]);return ye(()=>{const{search:S,terminate:h}=de(),f=ge(y=>{const{resultsFilter:q=l=>l,querySplitter:d,suggestionsFilter:E,...r}=u.value;y?(n.value+=1,S(y,i.value,r).then(l=>q(l,y,i.value,R.value)).then(l=>{n.value-=1,v.value=l}).catch(l=>{console.warn(l),n.value-=1,n.value||(v.value=[])})):v.value=[]},C.searchDelay-C.suggestDelay,{maxWait:5e3});pe([t,i],([y])=>f(y.join(" "))),ke(()=>{h()})}),{isSearching:k,results:v}};var we=N({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:u}){const i=X(),R=T(),n=Z(ee),{addQueryHistory:k,queryHistories:v,removeQueryHistory:S}=Le(),{resultHistories:h,addResultHistory:f,removeResultHistory:y}=Re(),q=se(t,"queries"),{results:d,isSearching:E}=Se(q),r=ae({isQuery:!0,index:0}),l=V(0),m=V(0),U=L(()=>v.value.length>0||h.value.length>0),w=L(()=>d.value.length>0),x=L(()=>d.value[l.value]||null),F=()=>{const{isQuery:e,index:s}=r;s===0?(r.isQuery=!e,r.index=e?h.value.length-1:v.value.length-1):r.index=s-1},b=()=>{const{isQuery:e,index:s}=r;s===(e?v.value.length-1:h.value.length-1)?(r.isQuery=!e,r.index=0):r.index=s+1},j=()=>{l.value=l.value>0?l.value-1:d.value.length-1,m.value=x.value.contents.length-1},O=()=>{l.value=l.value<d.value.length-1?l.value+1:0,m.value=0},G=()=>{m.value<x.value.contents.length-1?m.value+=1:O()},Y=()=>{m.value>0?m.value-=1:j()},Q=e=>e.map(s=>fe(s)?s:a(s[0],s[1])),z=e=>{if(e.type==="customField"){const s=oe[e.index]||"$content",[o,H=""]=ce(s)?s[R.value].split("$content"):s.split("$content");return e.display.map(c=>a("div",Q([o,...c,H])))}return e.display.map(s=>a("div",Q(s)))},B=()=>{l.value=0,m.value=0,u("updateQuery",""),u("close")},J=()=>a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},n.value.queryHistory),v.value.map((e,s)=>a("div",{class:["slimsearch-result-item",{active:r.isQuery&&r.index===s}],onClick:()=>{u("updateQuery",e)}},[a(D,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},e),a("button",{class:"slimsearch-remove-icon",innerHTML:P,onClick:o=>{o.preventDefault(),o.stopPropagation(),S(s)}})]))])),K=()=>a("ul",{class:"slimsearch-result-list"},a("li",{class:"slimsearch-result-list-item"},[a("div",{class:"slimsearch-result-title"},n.value.resultHistory),h.value.map((e,s)=>a(A,{to:e.link,class:["slimsearch-result-item",{active:!r.isQuery&&r.index===s}],onClick:()=>{B()}},()=>[a(D,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[e.header?a("div",{class:"content-header"},e.header):null,a("div",e.display.map(o=>Q(o)).flat())]),a("button",{class:"slimsearch-remove-icon",innerHTML:P,onClick:o=>{o.preventDefault(),o.stopPropagation(),y(s)}})]))]));return le("keydown",e=>{if(t.isFocusing){if(w.value){if(e.key==="ArrowUp")Y();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const s=x.value.contents[m.value];k(t.queries.join(" ")),f(s),i.push(_(s)),B()}}else if(e.key==="ArrowUp")F();else if(e.key==="ArrowDown")b();else if(e.key==="Enter"){const{index:s}=r;r.isQuery?(u("updateQuery",v.value[s]),e.preventDefault()):(i.push(h.value[s].link),B())}}}),te([l,m],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>a("div",{class:["slimsearch-result-wrapper",{empty:t.queries.length?!w.value:!U.value}],id:"slimsearch-results"},t.queries.length?E.value?a(re,{hint:n.value.searching}):w.value?a("ul",{class:"slimsearch-result-list"},d.value.map(({title:e,contents:s},o)=>{const H=l.value===o;return a("li",{class:["slimsearch-result-list-item",{active:H}]},[a("div",{class:"slimsearch-result-title"},e||n.value.defaultTitle),s.map((c,W)=>{const I=H&&m.value===W;return a(A,{to:_(c),class:["slimsearch-result-item",{active:I,"aria-selected":I}],onClick:()=>{k(t.queries.join(" ")),f(c),B()}},()=>[c.type==="text"?null:a(c.type==="title"?ue:c.type==="heading"?ie:ne,{class:"slimsearch-result-type"}),a("div",{class:"slimsearch-result-content"},[c.type==="text"&&c.header?a("div",{class:"content-header"},c.header):null,a("div",z(c))])])})])})):n.value.emptyResult:U.value?[J(),K()]:n.value.emptyHistory)}});export{we as default};
